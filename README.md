# 智核分流系统

<div align="center">

**智能域名转发管理系统**

[![GitHub stars](https://img.shields.io/github/stars/andy07559/kore-url)](https://github.com/andy07559/kore-url)
[![PHP 8.0+](https://img.shields.io/badge/PHP-8.0+--blue)](https://www.php.net/releases/8.0/)
[![License](https://img.shields.io/badge/License-MIT-green)](LICENSE)

**Version: 2.01**

</div>

---

## 目录

- [简介](#简介)
- [功能特性](#功能特性)
- [七种转发模式](#七种转发模式)
- [会员系统](#会员系统)
- [环境要求](#环境要求)
- [安装部署](#安装部署)
- [使用指南](#使用指南)
- [常见问题](#常见问题)
- [联系信息](#联系信息)

---

## 简介

智核分流系统是一款专业的域名转发管理系统，支持多种转发模式，满足不同场景的需求。系统采用 PHP 8.x + Smarty 4.x 技术架构，具有高性能、易扩展、安全可靠的特点。

### 核心功能

- ✅ 7种转发模式（显性、隐性、隐藏式、302、页面停放、1转多、短域名）
- ✅ 会员系统（密钥开通、域名限制、到期管理）
- ✅ HTTPS 自动转发（通配符证书支持）
- ✅ 多服务器负载均衡
- ✅ 地理位置转发（短域名模式）

---

## 功能特性

### 转发功能

| 功能 | 说明 |
|-----|------|
| 301显性转发 | SEO友好，权重传递 |
| 302隐性转发 | 地址栏不变，隐藏目标 |
| 隐藏式转发 | 与隐性相同，标签更友好 |
| 302跳转 | 临时跳转，测试专用 |
| 页面停放 | 自定义停放页面 |
| 1转多 | 流量分配，A/B测试 |
| 短域名 | 地理位置转发 |

### 管理功能

| 功能 | 说明 |
|-----|------|
| 用户管理 | 注册、登录、权限控制 |
| 会员系统 | VIP等级、密钥开通、域名限制 |
| 密钥管理 | 生成、分发、回收 |
| 域名管理 | 添加、编辑、删除、统计分析 |

---

## 七种转发模式

### 1. 显性转发（301永久跳转）

**模式值：** `0`

**工作原理：**
```
用户访问 https://abc.com
        ↓
服务器返回 301 重定向
        ↓
浏览器自动跳转到 https://target.com
        ↓
地址栏显示目标网址
```

**特点：**
- 地址栏变成目标网址
- SEO权重传递（301告诉搜索引擎是永久转移）
- 用户明确知道跳转到哪里
- 适合长期使用的域名

**适用场景：**
- 品牌域名跳转
- 域名更换过渡
- 长期合作推广

**示例配置：**
```
源域名：abc.com
目标地址：https://www.baidu.com
```

---

### 2. 隐性转发（iframe嵌入）

**模式值：** `1`

**工作原理：**
```
用户访问 https://abc.com
        ↓
服务器返回 iframe 嵌入页面
        ↓
页面内容为目标网址，但地址栏不变
        ↓
地址栏仍显示 https://abc.com
```

**特点：**
- 地址栏显示源域名，不显示目标网址
- 用户感觉仍在源域名上
- 部分网站会阻止 iframe 嵌入（X-Frame-Options）

**适用场景：**
- 隐藏目标网址
- 品牌统一展示
- 需要在地址栏显示自己域名的场景

**示例配置：**
```
源域名：abc.com
目标地址：https://www.baidu.com
页面标题：我的导航站
关键字：网址导航,在线工具
页面描述：这是一个综合网址导航
```

**注意事项：**
以下网站会阻止 iframe 嵌入：
- Netflix、Google、淘宝、抖音等
- 设置了 `X-Frame-Options: SAMEORIGIN` 的网站

建议对这类网站使用 **显性转发** 或 **302跳转**。

---

### 3. 隐藏式转发

**模式值：** `6`

**工作原理：**
与隐性转发完全相同，唯一的区别是：

| 对比项 | 隐性转发 | 隐藏式转发 |
|-------|---------|-----------|
| 标签显示 | 目标地址 | 域名 |
| 用户填写体验 | 感觉是"转发" | 感觉是"绑定域名" |
| 转发效果 | iframe嵌入 | iframe嵌入 |
| 地址栏 | 不变 | 不变 |

**特点：**
- 心理上更友好，用户感觉是在"绑定域名"而非"转发"
- 与隐性转发功能完全一致

**适用场景：**
- 希望用户感觉是"自己的域名"
- 隐藏目标网址
- 品牌统一展示

---

### 4. 302跳转（临时跳转）

**模式值：** `3`

**工作原理：**
```
用户访问 https://abc.com
        ↓
服务器返回 302 临时重定向
        ↓
浏览器跳转到 https://target.com
        ↓
地址栏显示目标网址
```

**特点：**
- 地址栏变成目标网址
- SEO权重不传递（302是临时转移）
- 适用于临时跳转场景

**适用场景：**
- 活动页面跳转
- A/B测试
- 短期推广链接
- 临时维护页面

**示例配置：**
```
源域名：promo.abc.com
目标地址：https://promotion.example.com/spring
```

---

### 5. 页面停放

**模式值：** `2`

**工作原理：**
```
用户访问 https://abc.com
        ↓
服务器返回自定义停放页面
        ↓
显示预设的页面内容
```

**特点：**
- 不跳转到其他网站
- 显示自定义停放页面
- 可以设置标题、关键字、描述

**适用场景：**
- 域名未启用时展示
- 域名出售页面
- 品牌介绍页面

**示例配置：**
```
源域名：abc.com
目标地址：https://www.example.com
页面标题：欢迎访问ABC
关键字：ABC,品牌
页面描述：ABC官方主页
停放页面：默认页面
```

---

### 6. 1转多（多目标转发）

**模式值：** `4`

**工作原理：**
```
用户访问 https://abc.com
        ↓
根据配置规则选择一个目标网址跳转
        ↓
目标可以是：依次用完一个再下一个 / 随机选择
```

**配置选项：**

| 选项 | 说明 |
|-----|------|
| 转发目标 | 添加多个目标网址，每个可设置访问次数限制 |
| 兜底地址 | 所有目标都用完后跳转的网址 |
| 转发模式 | 依次转发 / 轮转（随机） |

**转发模式说明：**

1. **依次转发**
   - 按顺序使用每个目标
   - 每个目标有访问次数限制
   - 用完一个自动用下一个
   - 全部用完使用兜底地址

2. **轮转（随机）**
   - 每次随机选择一个可用目标
   - 支持访问次数限制
   - 用完的目标不再被选择

**适用场景：**
- A/B测试（50%用户去A，50%用户去B）
- 流量分配（80%去主站，20%去备用）
- 负载均衡
- 多平台分发

**示例配置：**
```
转发目标：
├── [http://target1.com] [访问次数:1000]
├── [http://target2.com] [访问次数:1000]
└── [+ 添加转发目标]

兜底地址：http://fallback.com
转发模式：[依次转发 v]
```

---

### 7. 短域名（地理位置转发）

**模式值：** `5`

**工作原理：**
```
用户访问 https://abc.com
        ↓
302跳转到 https://08.ink/短码
        ↓
08.ink 根据用户地理位置转发
        ↓
中国用户 → cn.example.com
美国用户 → us.example.com
日本用户 → jp.example.com
其他用户 → 默认目标
```

**特点：**
- 支持地理位置转发（Geo Targeting）
- 不同国家/地区跳转到不同目标
- 利用 08.ink 的全球节点加速
- 短码格式：1-99

**配置选项：**

| 选项 | 说明 |
|-----|------|
| 目标地址 | 默认跳转目标网址 |
| 短码 | 1-99 的数字 |

**在 08.ink 设置地理位置转发：**

1. 登录 `https://08.ink/user/login`
2. 编辑对应的短链
3. 在「Geo Targeting」中添加：
```
cn: https://cn.example.com      # 中国
us: https://us.example.com     # 美国
jp: https://jp.example.com    # 日本
默认: https://default.example.com
```

**示例配置：**
```
短码：88
目标地址：https://www.baidu.com

08.ink Geo Targeting 设置：
├── cn: https://baidu.com      # 中国
├── us: https://google.com     # 美国
├── jp: https://yahoo.co.jp    # 日本
└── (其他): https://baidu.com  # 默认
```

---

## 会员系统

### 会员等级

| 等级 | 名称 | 默认域名限制 | 说明 |
|-----|------|------------|------|
| 0 | 普通用户 | 0 | 注册后默认，无法创建域名 |
| 1 | VIP1 | 5 | 基础会员 |
| 2 | VIP2 | 20 | 中级会员 |
| 3 | VIP3 | 100 | 高级会员 |
| 99 | 永久VIP | 0 | 管理员开通，无限制 |

### 开通方式

**方式一：密钥开通**

1. 管理员在后台生成 VIP 密钥
2. 设置会员等级、时长、域名限制
3. 发放密钥给用户
4. 用户在「用户中心」→「激活VIP」中输入密钥

**方式二：管理员手动开通**

1. 管理员登录后台
2. 进入「用户列表」
3. 点击「编辑」用户
4. 设置会员等级、到期时间、域名限制

### 密钥说明

- **格式**：`VIP-XXXXXXXXXXXX`（12位随机字符）
- **使用**：一次性使用，每个密钥只能被一个用户激活
- **安全**：激活后绑定用户，无法转让

### 到期处理

- **非永久VIP**：到期后自动降级为普通用户
- **已创建域名**：降级后仍可正常访问（只读）
- **续费**：管理员可手动延长到期时间

---

## 环境要求

### 基础要求

- **PHP 版本**：8.0 或更高
- **数据库**：MySQL 5.7+ / MariaDB 10.2+
- **Web 服务器**：Nginx / Apache
- **PHP 扩展**：pdo, pdo_mysql, gd, session

### 推荐配置

- PHP 8.2
- MySQL 8.0
- Nginx 1.24
- 至少 512MB 内存

---

## 安装部署

### 1. 上传文件

将所有文件上传到网站根目录，例如：`/www/wwwroot/url/`

### 2. 设置目录权限

```bash
chown -R www:www /www/wwwroot/url
chmod -R 755 /www/wwwroot/url
chmod -R 777 /www/wwwroot/url/templates_c
chmod -R 777 /www/wwwroot/url/cache
```

> www:www 为 Web 服务器用户，根据系统可能为 `nginx:nginx`、`www-data:www-data` 等

### 3. 创建数据库

如果数据库不存在，安装向导会自动创建。也可以提前创建：

```sql
CREATE DATABASE `你的数据库名` DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE USER '你的用户名'@'localhost' IDENTIFIED BY '你的密码';
GRANT ALL PRIVILEGES ON `你的数据库名`.* TO '你的用户名'@'localhost';
FLUSH PRIVILEGES;
```

### 4. 运行安装向导

浏览器访问：`http://你的域名/install.php`

按照向导填写：
1. **数据库配置** - 主机、端口、库名、用户名、密码
2. **管理员账户** - 邮箱和密码

点击「开始安装」即可完成！

### 5. 首次配置

安装完成后，登录管理员后台 `http://你的域名/admin/`，进入「网站配置」设置：

| 配置项 | 说明 |
|-------|------|
| home_domain | 网站主域名 |
| register_switch | 是否开放新用户注册 |
| domain_add_switch | 是否允许添加域名 |
| audit | 是否需要审核域名 |
| smtp | 邮件服务器配置（可选） |

---

## 使用指南

### 用户操作

#### 注册账号

1. 访问网站首页
2. 点击「注册」
3. 填写邮箱、密码
4. 登录使用

#### 激活VIP

1. 获取管理员提供的 VIP 密钥
2. 登录用户中心
3. 点击「激活VIP」
4. 输入密钥并提交
5. 开通成功，获得对应权限

#### 添加域名

1. 登录用户中心
2. 点击「添加域名」
3. 填写域名和选择转发类型
4. 根据类型填写相应配置
5. 提交完成

#### 编辑域名

1. 在域名列表点击「编辑」
2. 修改转发配置
3. 保存更改

#### 删除域名

1. 在域名列表点击「删除」
2. 确认删除（不可恢复）
3. 释放域名名额

---

### 管理员操作

#### 用户管理

- **查看用户列表**：后台 → 用户列表
- **编辑用户**：点击「编辑」修改邮箱、密码、会员状态
- **手动开通VIP**：在编辑页面设置会员等级、到期时间、域名限制

#### 密钥管理

- **生成密钥**：后台 → VIP密钥 → 生成新密钥
- **设置参数**：选择等级、时长、域名限制、生成数量
- **分发密钥**：将生成的密钥发给用户
- **删除密钥**：删除未使用的密钥

#### 系统配置

- **网站配置**：后台 → 网站配置
- **域名列表**：后台 → 域名列表
- **统计分析**：查看整体数据

---

## 常见问题

### Q1: 500错误

- 检查 `templates_c` 和 `cache` 目录权限是否为 777
- 检查 PHP 错误日志

### Q2: 转发不生效

- 确认域名已正确解析到服务器
- 使用 `ping 域名` 验证 DNS 是否生效
- 检查域名是否在允许列表中

### Q3: 隐性转发显示空白

- 目标网站设置了 X-Frame-Options 阻止嵌入
- 建议改用显性转发或 302 跳转

### Q4: 从旧版升级

- 访问 `http://你的域名/upgrade.php`
- 点击「执行数据库升级」

### Q5: HTTPS 相关

- 主域名子域名自动支持 HTTPS（通配符证书）
- 外部域名需要单独申请 SSL 证书

---

## 联系信息

**软件名称：** 智核分流系统

**版本：** 2.01

**GitHub：** https://github.com/andy07559/kore-url

**联系邮箱：** url@590.net

**联系电话：** +15035014736

**技术支持：** 通过 GitHub Issues 提交问题

---

## 许可证

MIT License

Copyright (c) 2024 智核科技

---

<div align="center">

**智核分流系统** - 让域名转发更智能

</div>
